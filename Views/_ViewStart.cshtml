@{
    Layout = "~/DesktopModules/MVC/FacebookModule/Views/Shared/_Layout.cshtml";
}

<script>
    $(document).ready(function () {
        $('#errors').hide();
        $('.loggedIn').hide();
        $.ajaxSetup({ cache: true });
        $.getScript('//connect.facebook.net/en_US/sdk.js', function () {
            FB.init({
                //MSKE ENV VARIABLES
                appId: '183652722184096',
                cookie: true,
                xfbml: true,
                version: 'v2.10'
            });
            //CALLS FUNCTION TO CHECK LOGIN STATUS
            checkStatus();
        });
    });

    function checkStatus() {
        $.getScript('//connect.facebook.net/en_US/sdk.js', function () {
            FB.getLoginStatus(function (response) {
                if (response.status === 'connected') {
                    // USER IS LOGGED IN TO FACEBOOK, SHOWS PERSONALIZED DIVS
                    $('.loggedIn').show();
                    $('#loginStatus').html('You are currently logged in.');
                    getProfileData();
                } else {
                    // USER IS NOT LOGGED IN, HIDES RELEVANT DIVS
                    $('.loggedIn').hide();
                    $('#loginStatus').html('Please connect to Facebook to continue using this app.');
                }
            });
        });
    }

    function submitMessage(e) {
        //CALLS FB API TO POST USER MESSAGE TO FEED
        var message = $('#message').val();
        FB.api(
            '/me/feed',
            'POST',
            {
                'message': message
            },
            function (response) {
                if (response && !response.error) {
                    $('#postStatus').html('Successful post to your FB feed!');
                }
                else {
                    $('#errors').show();
                    $('#error').html(JSON.stringify(response));
                }
            }
        );
    }

    function getProfileData() {
        //CALLS FB API TO GET PROFILE INFO
        FB.api('/me',
            'GET',
            function (response) {
                if (response && !response.error) {
                    console.log(response);
                    $('#userName').html(response.name);
                }
                else {
                    $('#errors').show();
                    $("#error").html(JSON.stringify(response));
                }
            }
        );
        //CALLS FB API TO GET USER LIKES
        FB.api('/me/likes', function (response) {
            if (response && !response.error) {
                //PUTS FIRST 25 LIKES INTO TABLE
                $.each(response.data, function (name, value) {
                    $("#likes").append(('<tr><td><p>' + value.name + '</p></td></tr>').toString());
                });
            }
            else {
                $('#errors').show();
                $("#error").html(JSON.stringify(response));
            }
        });
    }
</script>


<div class="jumbotron jumbotron-fluid">
    <h2>Facebook Module</h2>
</div>
<div class="container">
    <h3 class="loggedIn">Welcome, <span id="userName"></span></h3>
    <fb:login-button scope="public_profile, email, user_hometown, user_likes, publish_actions" autologoutlink="true" onlogin="checkStatus()"></fb:login-button>
    <p><span id="loginStatus"></span></p>
  
    <div class="loggedIn">
        <div id="profileData">
            <h4>25 FACEBOOK LIKES</h4>
            <div id="profileInfo"></div>
            <div class="table-responsive" style="max-height:300px;max-width:500px;">
                <table class="table">
                    <tbody id="likes">
                    </tbody>
                </table>
            </div>
        </div>
        <div id="postMessage">
            <h5>Enter a message to post to your feed:</h5>
            <div class="container">
                <textarea class="col-md-5" id="message"></textarea>
            </div>
            <div class="container">
                <button type="button" id="postFeedTxt" class="btn btn-primary" onClick="submitMessage()">POST</button>
                <br />
                <p><span id='postStatus'></span></p>
            </div>
        </div>
    </div>
    <div id='errors'>
        <div class='alert alert-danger'>
            <p><span id='error'></span></p>
        </div>
    </div>
</div>